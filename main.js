/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e="",t=null,n=function(e){"Escape"===e.key&&t&&a(t)},r=function(e){e.classList.add("popup_is-opened"),t=e,document.addEventListener("keydown",n)},a=function(e){e.classList.remove("popup_is-opened"),t===e&&(t=null,document.removeEventListener("keydown",n))},o=function(e,t){e.addEventListener("click",(function(){return r(t)}))};function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function i(){i=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},u=o.iterator||"@@iterator",d=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function p(e,t,n,r){var o=t&&t.prototype instanceof g?t:g,c=Object.create(o.prototype),i=new D(r||[]);return a(c,"_invoke",{value:C(e,n,i)}),c}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=p;var m="suspendedStart",v="suspendedYield",h="executing",y="completed",_={};function g(){}function b(){}function S(){}var w={};s(w,u,(function(){return this}));var q=Object.getPrototypeOf,L=q&&q(q(O([])));L&&L!==n&&r.call(L,u)&&(w=L);var I=S.prototype=g.prototype=Object.create(w);function E(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(a,o,i,u){var d=f(e[a],e,o);if("throw"!==d.type){var l=d.arg,s=l.value;return s&&"object"==c(s)&&r.call(s,"__await")?t.resolve(s.__await).then((function(e){n("next",e,i,u)}),(function(e){n("throw",e,i,u)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return n("throw",e,i,u)}))}u(d.arg)}var o;a(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,a){n(e,r,t,a)}))}return o=o?o.then(a,a):a()}})}function C(t,n,r){var a=m;return function(o,c){if(a===h)throw Error("Generator is already running");if(a===y){if("throw"===o)throw c;return{value:e,done:!0}}for(r.method=o,r.arg=c;;){var i=r.delegate;if(i){var u=k(i,r);if(u){if(u===_)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===m)throw a=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=h;var d=f(t,n,r);if("normal"===d.type){if(a=r.done?y:v,d.arg===_)continue;return{value:d.arg,done:r.done}}"throw"===d.type&&(a=y,r.method="throw",r.arg=d.arg)}}}function k(t,n){var r=n.method,a=t.iterator[r];if(a===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,k(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),_;var o=f(a,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,_;var c=o.arg;return c?c.done?(n[t.resultName]=c.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,_):c:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,_)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function O(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function n(){for(;++a<t.length;)if(r.call(t,a))return n.value=t[a],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(c(t)+" is not iterable")}return b.prototype=S,a(I,"constructor",{value:S,configurable:!0}),a(S,"constructor",{value:b,configurable:!0}),b.displayName=s(S,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,s(e,l,"GeneratorFunction")),e.prototype=Object.create(I),e},t.awrap=function(e){return{__await:e}},E(x.prototype),s(x.prototype,d,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var c=new x(p(e,n,r,a),o);return t.isGeneratorFunction(n)?c:c.next().then((function(e){return e.done?e.value:c.next()}))},E(I),s(I,l,"Generator"),s(I,u,(function(){return this})),s(I,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=O,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(r,a){return i.type="throw",i.arg=t,n.next=r,a&&(n.method="next",n.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var c=this.tryEntries[o],i=c.completion;if("root"===c.tryLoc)return a("end");if(c.tryLoc<=this.prev){var u=r.call(c,"catchLoc"),d=r.call(c,"finallyLoc");if(u&&d){if(this.prev<c.catchLoc)return a(c.catchLoc,!0);if(this.prev<c.finallyLoc)return a(c.finallyLoc)}else if(u){if(this.prev<c.catchLoc)return a(c.catchLoc,!0)}else{if(!d)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return a(c.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var c=o?o.completion:{};return c.type=e,c.arg=t,o?(this.method="next",this.next=o.finallyLoc,_):this.complete(c)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),_},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),_}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;A(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:O(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),_}},t}function u(e,t,n,r,a,o,c){try{var i=e[o](c),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(r,a)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function c(e){u(o,r,a,c,i,"next",e)}function i(e){u(o,r,a,c,i,"throw",e)}c(void 0)}))}}var l=function(){var e=d(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.ok){e.next=2;break}throw new Error("Error: ".concat(t.status));case 2:return e.abrupt("return",t.json());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s=function(){var e=d(i().mark((function e(t){var n,r,a,o,c,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.email,r=t.password,a=t.phone,o=t.inn,c=t.role,e.next=3,fetch("".concat("http://localhost:3000/api/auth","/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password:r,phone:a,inn:o,role:c})});case 3:return u=e.sent,e.abrupt("return",l(u));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function f(){f=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function d(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var o=t&&t.prototype instanceof g?t:g,c=Object.create(o.prototype),i=new D(r||[]);return a(c,"_invoke",{value:C(e,n,i)}),c}function s(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var m="suspendedStart",v="suspendedYield",h="executing",y="completed",_={};function g(){}function b(){}function S(){}var w={};d(w,c,(function(){return this}));var q=Object.getPrototypeOf,L=q&&q(q(O([])));L&&L!==n&&r.call(L,c)&&(w=L);var I=S.prototype=g.prototype=Object.create(w);function E(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(a,o,c,i){var u=s(e[a],e,o);if("throw"!==u.type){var d=u.arg,l=d.value;return l&&"object"==p(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,c,i)}),(function(e){n("throw",e,c,i)})):t.resolve(l).then((function(e){d.value=e,c(d)}),(function(e){return n("throw",e,c,i)}))}i(u.arg)}var o;a(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,a){n(e,r,t,a)}))}return o=o?o.then(a,a):a()}})}function C(t,n,r){var a=m;return function(o,c){if(a===h)throw Error("Generator is already running");if(a===y){if("throw"===o)throw c;return{value:e,done:!0}}for(r.method=o,r.arg=c;;){var i=r.delegate;if(i){var u=k(i,r);if(u){if(u===_)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===m)throw a=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=h;var d=s(t,n,r);if("normal"===d.type){if(a=r.done?y:v,d.arg===_)continue;return{value:d.arg,done:r.done}}"throw"===d.type&&(a=y,r.method="throw",r.arg=d.arg)}}}function k(t,n){var r=n.method,a=t.iterator[r];if(a===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,k(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),_;var o=s(a,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,_;var c=o.arg;return c?c.done?(n[t.resultName]=c.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,_):c:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,_)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function O(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function n(){for(;++a<t.length;)if(r.call(t,a))return n.value=t[a],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(p(t)+" is not iterable")}return b.prototype=S,a(I,"constructor",{value:S,configurable:!0}),a(S,"constructor",{value:b,configurable:!0}),b.displayName=d(S,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,d(e,u,"GeneratorFunction")),e.prototype=Object.create(I),e},t.awrap=function(e){return{__await:e}},E(x.prototype),d(x.prototype,i,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var c=new x(l(e,n,r,a),o);return t.isGeneratorFunction(n)?c:c.next().then((function(e){return e.done?e.value:c.next()}))},E(I),d(I,u,"Generator"),d(I,c,(function(){return this})),d(I,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=O,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(r,a){return i.type="throw",i.arg=t,n.next=r,a&&(n.method="next",n.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var c=this.tryEntries[o],i=c.completion;if("root"===c.tryLoc)return a("end");if(c.tryLoc<=this.prev){var u=r.call(c,"catchLoc"),d=r.call(c,"finallyLoc");if(u&&d){if(this.prev<c.catchLoc)return a(c.catchLoc,!0);if(this.prev<c.finallyLoc)return a(c.finallyLoc)}else if(u){if(this.prev<c.catchLoc)return a(c.catchLoc,!0)}else{if(!d)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return a(c.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var c=o?o.completion:{};return c.type=e,c.arg=t,o?(this.method="next",this.next=o.finallyLoc,_):this.complete(c)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),_},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),_}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;A(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:O(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),_}},t}function m(e,t,n,r,a,o,c){try{var i=e[o](c),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(r,a)}const v=e+"5f65fef1ca587ca985dd.svg",h=e+"ae7b9cbc8c89f35a8333.svg",y=e+"c6734c22f776518aeef0.svg";var _=function(){var e,t,n,r=[],a=null,o=document.querySelector("#auction-bids-list"),c=document.querySelector(".start-auction-btn"),i=document.querySelector("#auction-status"),u=document.querySelector(".deal-card"),d=document.querySelector(".confirm-deal-btn"),l=document.querySelector("#deal-pdf");if(c&&o&&i&&u&&d&&l){var s=["АгроТрейд","Зерновой Союз","Ферма Иванова","Сельхоз Кооператив","Торговая Лига"],p=function(e){return"".concat(parseInt(e).toLocaleString()," ₽")};c.addEventListener("click",(function(){i.textContent="Аукцион идёт!",c.style.display="none",o.parentElement.style.display="table",t=Date.now()+3e4,e=setInterval((function(){var o=t-Date.now(),c=document.querySelector("#auction-timer");o<=0?(function(){if(clearInterval(e),clearInterval(n),r.length>0){var t=r.reduce((function(e,t){return t.price>e.price?t:e}));i.textContent="Аукцион завершён! Победитель: ".concat(t.participant," с ценой ").concat(p(t.price)),a={id:"DEMO-001",buyer:t.participant,price:p(t.price),volume:"6 тонн",date:(new Date).toLocaleString()};var o=document.createElement("div");o.classList.add("auction-protocol"),o.innerHTML="\n        <h3>Протокол аукциона</h3>\n        <p>Дата завершения: ".concat((new Date).toLocaleString(),"</p>\n        <p>Победитель: ").concat(t.participant,"</p>\n        <p>Итоговая цена: ").concat(p(t.price),"</p>\n        <p>Количество ставок: ").concat(r.length,"</p>\n      "),document.querySelector(".auc").appendChild(o);var c=document.querySelector("#auction-history");if(c){var d=document.createElement("li");d.textContent="Аукцион #DEMO-".concat(r.length,": Пшеница, 6 тонн, завершён ").concat((new Date).toLocaleString()),c.appendChild(d)}else console.warn("Auction history element not found");u.style.display="block",document.querySelector("#deal-buyer").textContent=t.participant,document.querySelector("#deal-price").textContent=p(t.price),document.querySelector("#deal-volume").textContent="6 тонн",document.querySelector("#deal-status").textContent="Ожидает подтверждения"}else i.textContent="Аукцион завершён! Ставок не было."}(),c&&(c.textContent="Аукцион завершён")):(c&&(c.textContent="".concat(Math.ceil(o/1e3)," сек")),i.textContent="Аукцион идёт")}),1e3),n=setInterval((function(){!function(e,t){r.push({participant:e,price:t,time:Date.now()}),o.innerHTML="",r.forEach((function(e){var t=document.createElement("tr");t.innerHTML="\n        <td>".concat(e.participant,"</td>\n        <td>").concat(p(e.price),"</td>\n        <td>").concat(new Date(e.time).toLocaleString(),"</td>\n      "),o.appendChild(t)}))}(s[Math.floor(Math.random()*s.length)],Math.floor(5e3*Math.random())+1e4)}),8e3)})),d.addEventListener("click",(function(){document.querySelector("#deal-status").textContent="Контракт ожидает подписи покупателя",d.style.display="none",setTimeout((function(){document.querySelector("#deal-status").textContent="Контракт заключён",l.style.display="inline-block";var e=document.querySelector("#deliveries-list"),t=document.createElement("tr"),n="DEMO-".concat(String(r.length+1).padStart(3,"0"));t.dataset.dealId=n,t.innerHTML="\n      <td>".concat(n,"</td>\n      <td>Пшеница, 6 тонн</td>\n      <td>").concat(a.buyer,'</td>\n      <td><span class="status-icon status-yellow">Ожидает отгрузки</span></td>\n      <td>').concat((new Date).toLocaleDateString(),"</td>\n    "),e.appendChild(t);var o=document.querySelector("#deal-timeline-content"),c=document.createElement("p");c.dataset.dealId=n,c.textContent="".concat((new Date).toLocaleString(),": Сделка подтверждена фермером."),o.appendChild(c)}),5e3)})),l.addEventListener("click",(function(){if(a){var e=new(0,window.jspdf.jsPDF);e.setFont("Times","normal"),e.setFontSize(16),e.text("Карточка сделки",20,20),e.setFontSize(12),e.text("ID сделки: ".concat(a.id),20,40),e.text("Покупатель: ".concat(a.buyer),20,50),e.text("Цена: ".concat(a.price),20,60),e.text("Объём: ".concat(a.volume),20,70),e.text("Дата: ".concat(a.date),20,80),e.save("deal-DEMO-001.pdf")}else alert("Данные сделки недоступны.")}))}else console.warn("One or more auction elements are missing. Auction functionality disabled.")};function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var b,S=document.createElement("style");S.textContent="\n  .notification__message {\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    padding: 10px 20px;\n    background-color: #4a7150;\n    color: #fff;\n    border-radius: 5px;\n    z-index: 1000;\n    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);\n  }\n  .notification__message.error {\n    background-color: #d32f2f;\n  }\n",document.head.appendChild(S),b=document.querySelectorAll(".popup"),document.querySelectorAll(".popup__close").forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return a(t)}))})),b.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target===e&&a(e)}))})),document.querySelector(".page")?function(){var e=document.querySelector(".header__login"),t=document.querySelector(".header__reg"),n=document.querySelector(".popup_type_auth"),r=document.querySelector(".popup_type_reg");o(e,n),o(t,r);var c=document.forms.reg;c.addEventListener("submit",function(){var e,t=(e=f().mark((function e(t){var n,o,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),n=new FormData(c),(o={email:n.get("email"),password:n.get("password"),phone:n.get("phone"),inn:n.get("inn"),role:n.get("role")}).role){e.next=6;break}return alert("Пожалуйста, выберите роль: Покупатель или Фермер"),e.abrupt("return");case 6:return e.prev=6,e.next=9,s(o);case 9:(i=e.sent).error?alert(i.error):(a(r),window.location.href="buyer"===o.role?"./buyer.html":"./profile.html"),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(6),console.error("Registration error:",e.t0),alert("Something went wrong. Please try again later.");case 17:case"end":return e.stop()}}),e,null,[[6,13]])})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function c(e){m(o,r,a,c,i,"next",e)}function i(e){m(o,r,a,c,i,"throw",e)}c(void 0)}))});return function(e){return t.apply(this,arguments)}}())}():document.querySelector(".farmer")?function(){var e=document.querySelector(".ads__btn"),t=document.querySelector(".popup_type_ads"),n=document.querySelector(".ads .ads__list"),c=document.querySelector(".catalog .ads__list"),i=document.querySelector(".popup_type_auc"),u=document.querySelector(".popup_type_edit"),d=document.querySelector(".popup_type_delete");e&&t&&n&&c&&i&&u&&d||console.warn("One or more required elements are missing in profile.html");var l=[{id:"ad-1",culture:"Пшеница",sort:"Луговая",addres:"Казахстан",price:"10000",value:"6",shipment:"2025-05-20",description:"Высококачественная пшеница",farmerId:"farmer-1"},{id:"ad-2",culture:"Рожь",sort:"Степная",addres:"Россия, Волгоград",price:"8500",value:"10",shipment:"2025-06-01",description:"Рожь для хлебопечения",farmerId:"farmer-1"},{id:"ad-3",culture:"Ячмень",sort:"Золотой",addres:"Россия, Краснодар",price:"9000",value:"8",shipment:"2025-05-25",description:"Ячмень кормовой",farmerId:"farmer-1"},{id:"ad-4",culture:"Кукуруза",sort:"Сахарная",addres:"Россия, Ростов",price:"12000",value:"12",shipment:"2025-06-10",description:"Кукуруза для переработки",farmerId:"farmer-1"}],s=[{id:"ad-1",culture:"Пшеница",sort:"Луговая",addres:"Казахстан",price:"10000",value:"6",shipment:"2025-05-20",description:"Высококачественная пшеница",farmerId:"farmer-1"},{id:"ad-2",culture:"Рожь",sort:"Степная",addres:"Россия, Волгоград",price:"8500",value:"10",shipment:"2025-06-01",description:"Рожь для хлебопечения",farmerId:"farmer-1"},{id:"ad-3",culture:"Ячмень",sort:"Золотой",addres:"Россия, Краснодар",price:"9000",value:"8",shipment:"2025-05-25",description:"Ячмень кормовой",farmerId:"farmer-1"},{id:"ad-4",culture:"Кукуруза",sort:"Сахарная",addres:"Россия, Ростов",price:"12000",value:"12",shipment:"2025-06-10",description:"Кукуруза для переработки",farmerId:"farmer-1"},{id:"ad-5",culture:"Пшеница",sort:"Озимая",addres:"Украина",price:"11000",value:"5",shipment:"2025-05-30",description:"Пшеница твердых сортов",farmerId:"farmer-2"},{id:"ad-6",culture:"Овёс",sort:"Белый",addres:"Беларусь",price:"7000",value:"7",shipment:"2025-05-28",description:"Овёс для корма",farmerId:"farmer-3"},{id:"ad-7",culture:"Гречиха",sort:"Алтайская",addres:"Россия, Алтай",price:"15000",value:"4",shipment:"2025-06-05",description:"Гречиха для крупы",farmerId:"farmer-4"},{id:"ad-8",culture:"Соя",sort:"Ранняя",addres:"Россия, Амур",price:"18000",value:"3",shipment:"2025-06-15",description:"Соя для экспорта",farmerId:"farmer-5"},{id:"ad-9",culture:"Подсолнечник",sort:"Масличный",addres:"Россия, Саратов",price:"20000",value:"5",shipment:"2025-06-20",description:"Подсолнечник для масла",farmerId:"farmer-6"}];f(),m(),o(e,t);var p=document.forms.ads;function f(){var e=n.querySelector(".ads__list-header");n.innerHTML="",n.appendChild(e),l.forEach((function(e){var t=document.createElement("li");t.classList.add("ads__item"),t.dataset.id=e.id,t.innerHTML='\n        <span class="ads__ad">'.concat(e.culture,'</span>\n        <span class="ads__ad">').concat(e.sort,'</span>\n        <span class="ads__ad">').concat(e.addres,'</span>\n        <span class="ads__ad">').concat(e.price,'</span>\n        <span class="ads__ad">').concat(e.value,'</span>\n        <span class="ads__ad">').concat(e.shipment,'</span>\n        <span class="ads__ad">').concat(e.description,'</span>\n        <span class="ads__ad ads__edit-btn"><img style="width: 25px;" src="').concat(y,'" alt=""></span>\n        <span class="ads__ad ads__archive-btn"><img style="width: 25px;" src="').concat(h,'" alt=""></span>\n        <span class="ads__ad ads__auction-btn"><img style="width: 25px;" src="').concat(v,'" alt=""></span>\n      '),n.appendChild(t)}))}function m(){var e=c.querySelector(".ads__list-header");c.innerHTML="",c.appendChild(e),s.forEach((function(e){var t=document.createElement("li");t.classList.add("ads__item"),t.dataset.id=e.id,t.innerHTML='\n        <span class="ads__ad">'.concat(e.culture,'</span>\n        <span class="ads__ad">').concat(e.sort,'</span>\n        <span class="ads__ad">').concat(e.addres,'</span>\n        <span class="ads__ad">').concat(e.price,'</span>\n        <span class="ads__ad">').concat(e.value,'</span>\n        <span class="ads__ad">').concat(e.shipment,'</span>\n        <span class="ads__ad">').concat(e.description,"</span>\n      "),c.appendChild(t)}))}p.addEventListener("submit",(function(e){e.preventDefault();var n=new FormData(p),r={id:"ad-".concat(Date.now()),culture:n.get("culture"),sort:n.get("sort"),value:n.get("value"),price:n.get("price"),addres:n.get("addres"),shipment:n.get("shipment"),description:n.get("description"),farmerId:"farmer-1"};l.push(r),s.push(r),f(),m(),alert("Объявление добавлено в общий каталог!"),a(t)})),n.addEventListener("click",(function(e){var t=e.target.closest(".ads__edit-btn, .ads__archive-btn, .ads__auction-btn");if(t){var n=t.closest(".ads__item").dataset.id,o=l.find((function(e){return e.id===n}));t.classList.contains("ads__edit-btn")?(function(e){document.querySelector("#culture-edit-input").value=e.culture,document.querySelector("#sort-edit-input").value=e.sort,document.querySelector("#value-edit-input").value=e.value,document.querySelector("#price-edit-input").value=e.price,document.querySelector("#addres-edit-input").value=e.addres,document.querySelector("#shipment-edit-input").value=e.shipment,document.querySelector("#description-edit-input").value=e.description}(o),r(u),function(e,t){var n=t.querySelector("form"),r=function(o){o.preventDefault();var c={id:e,culture:document.querySelector("#culture-edit-input").value,sort:document.querySelector("#sort-edit-input").value,value:document.querySelector("#value-edit-input").value,price:document.querySelector("#price-edit-input").value,addres:document.querySelector("#addres-edit-input").value,shipment:document.querySelector("#shipment-edit-input").value,description:document.querySelector("#description-edit-input").value,farmerId:"farmer-1"};l=l.map((function(t){return t.id===e?c:t})),s=s.map((function(t){return t.id===e?c:t})),f(),m(),a(t),n.removeEventListener("submit",r)};n.addEventListener("submit",r)}(n,u)):t.classList.contains("ads__archive-btn")?(r(d),function(e,t){var n=t.querySelector("form"),r=function(o){o.preventDefault(),l=l.filter((function(t){return t.id!==e})),s=s.filter((function(t){return t.id!==e})),f(),m(),a(t),n.removeEventListener("submit",r)};n.addEventListener("submit",r)}(n,d)):t.classList.contains("ads__auction-btn")&&function(e,t){var n=document.querySelector(".popup_type_auc");document.querySelector("#start-price-input").value=t.price,document.querySelector("#duration-input").value=24,r(n);var o=n.querySelector("form"),c=function(r){r.preventDefault();var i=document.querySelector("#start-price-input").value;if(document.querySelector("#duration-input").value<24)alert("Длительность аукциона должна быть не менее 24 часов.");else{l=l.filter((function(t){return t.id!==e})),s=s.filter((function(t){return t.id!==e})),f(),m();var u=document.querySelector(".auction-placeholder"),d=document.querySelector(".auction-details"),p=document.querySelector(".start-auction-btn"),v=document.querySelector("#auction-status"),h=document.querySelector("#lot-details"),y=document.querySelector("#start-price"),_=document.querySelector("#auction-timer");u&&(u.style.display="none"),d&&(d.style.display="block"),p&&(p.style.display="block"),v&&(v.style.display="inline"),h&&(h.style.display="inline"),y&&(y.style.display="inline"),_&&(_.style.display="inline"),h?h.textContent="".concat(t.culture,", ").concat(t.sort,", ").concat(t.value," тонн, ").concat(t.addres):console.warn("Element #lot-details not found"),y?y.textContent="".concat(parseInt(i).toLocaleString()," ₽"):console.warn("Element #start-price not found"),v?v.textContent="Аукцион создан, нажмите 'Начать аукцион'":console.warn("Element #auction-status not found"),_?_.textContent="Ожидает запуска":console.warn("Element #auction-timer not found"),a(n),o.removeEventListener("submit",c)}};o.addEventListener("submit",c)}(n,o)}})),Object.values({catalog:{link:".header__link-catalog",section:".catalog"},ads:{link:".header__link-ads",section:".ads"},auc:{link:".header__link-auc",section:".auc"},deals:{link:".header__link-deals",section:".deals"},profile:{link:".header__link-profile",section:".profile"}}).forEach((function(e){var t=e.link,n=e.section,r=document.querySelector(t);r?r.addEventListener("click",(function(e){e.preventDefault();var t=document.querySelector(".active-sec"),r=document.querySelector(".active");t&&t.classList.remove("active-sec"),r&&r.classList.remove("active");var a=document.querySelector(n);a?(a.classList.add("active-sec"),e.target.classList.add("active")):console.warn("Section ".concat(n," not found"))})):console.warn("Navigation link ".concat(t," not found"))})),function(){var e=document.querySelector("#deliveries-list"),t=document.querySelector(".popup_type_status"),n=document.querySelector("#deal-timeline-content");if(e&&n){var o=document.querySelectorAll(".deliveries-table th.sortable");o.forEach((function(t){t.addEventListener("click",(function(){var n=t.dataset.sort,r=t.classList.toggle("asc");o.forEach((function(e){return e!==t&&e.classList.remove("asc","desc")})),t.classList.add(r?"asc":"desc");var a=Array.from(e.querySelectorAll("tr"));a.sort((function(e,t){var a,o;return"status"===n?(a=e.querySelector("td:nth-child(".concat("status"===n?4:"buyer"===n?3:"lot"===n?2:"date"===n?5:1,")")).textContent,o=t.querySelector("td:nth-child(".concat("status"===n?4:"buyer"===n?3:"lot"===n?2:"date"===n?5:1,")")).textContent):(a=e.querySelector("td:nth-child(".concat("buyer"===n?3:"lot"===n?2:"date"===n?5:1,")")).textContent,o=t.querySelector("td:nth-child(".concat("buyer"===n?3:"lot"===n?2:"date"===n?5:1,")")).textContent),r?a.localeCompare(o):o.localeCompare(a)})),e.innerHTML="",a.forEach((function(t){return e.appendChild(t)}))}))})),e.addEventListener("click",(function(e){var o=e.target.closest("tr");if(o){var c=o.dataset.dealId;n.querySelectorAll("p").forEach((function(e){e.style.display=e.dataset.dealId===c?"block":"none"}))}var i=e.target.closest("td:nth-child(4)");if(i){r(t);var u=document.forms.status,d=i.querySelector(".status-icon"),l=i.closest("tr").dataset.dealId;u.addEventListener("submit",(function e(r){r.preventDefault();var o=document.querySelector("#status-input").value,c=document.querySelector("#comment-input").value;d.textContent=o,d.className="status-icon ".concat("Принято"===o?"status-green":"status-yellow");var i=document.createElement("p");if(i.dataset.dealId=l,i.textContent="".concat((new Date).toLocaleString(),': Фермер изменил статус на "').concat(o,'". ').concat(c?"Комментарий: ".concat(c):""),n.appendChild(i),n.querySelectorAll("p").forEach((function(e){e.style.display=e.dataset.dealId===l?"block":"none"})),"Принято"===o){var s=document.createElement("p");s.dataset.dealId=l,s.textContent="".concat((new Date).toLocaleString(),": Платёжка загружена (заглушка)."),n.appendChild(s)}a(t),u.removeEventListener("submit",e)}))}}))}else console.warn("Deliveries list or timeline content not found")}(),_()}():document.querySelector(".buyer")&&function(){var e=document.querySelector(".catalog .catalog__list");if(e){var t,n,o="buyer-1",c="ООО АгроТрейд",i=[{id:"buyer-2",name:"ООО Хлебный путь"},{id:"buyer-3",name:"ИП Смирнов В.В."},{id:"buyer-4",name:"ООО ЗерноТрейд"}],u=[{id:"ad-1",culture:"Пшеница",sort:"Луговая",addres:"Казахстан",price:"10000",value:"6",shipment:"2025-05-20",description:"Высококачественная пшеница",farmerId:"ООО Золотая Нива",createdAt:"2025-05-10T10:00:00Z",email:"[email protected]",phone:"+7 (701) 234-56-78"},{id:"ad-2",culture:"Рожь",sort:"Степная",addres:"Россия, Волгоград",price:"8500",value:"10",shipment:"2025-06-01",description:"Рожь для хлебопечения",farmerId:"ИП Иванов А.А.",createdAt:"2025-05-09T12:00:00Z",email:"[email protected]",phone:"+7 (701) 234-56-78"},{id:"ad-3",culture:"Ячмень",sort:"Золотой",addres:"Россия, Краснодар",price:"9000",value:"8",shipment:"2025-05-25",description:"Ячмень кормовой",farmerId:"ООО Сельхозпродукт",createdAt:"2025-05-08T15:00:00Z",email:"[email protected]",phone:"+7 (701) 234-56-78"},{id:"ad-4",culture:"Кукуруза",sort:"Сахарная",addres:"Россия, Ростов",price:"12000",value:"12",shipment:"2025-06-10",description:"Кукуруза для переработки",farmerId:"ИП Петров П.П.",createdAt:"2025-05-07T09:00:00Z",email:"[email protected]",phone:"+7 (701) 234-56-78"},{id:"ad-5",culture:"Пшеница",sort:"Озимая",addres:"Украина",price:"11000",value:"5",shipment:"2025-05-30",description:"Пшеница твердых сортов",farmerId:"ООО АгроСоюз",createdAt:"2025-05-06T14:00:00Z",email:"[email protected]",phone:"+7 (702) 345-67-89"},{id:"ad-6",culture:"Овёс",sort:"Белый",addres:"Беларусь",price:"7000",value:"7",shipment:"2025-05-28",description:"Овёс для корма",farmerId:"ИП Сидоров С.С.",createdAt:"2025-05-05T11:00:00Z",email:"[email protected]",phone:"+7 (703) 456-78-90"},{id:"ad-7",culture:"Гречиха",sort:"Алтайская",addres:"Россия, Алтай",price:"15000",value:"4",shipment:"2025-06-05",description:"Гречиха для крупы",farmerId:"ООО АлтайАгро",createdAt:"2025-05-04T16:00:00Z",email:"[email protected]",phone:"+7 (704) 567-89-01"},{id:"ad-8",culture:"Соя",sort:"Ранняя",addres:"Россия, Амур",price:"18000",value:"3",shipment:"2025-06-15",description:"Соя для экспорта",farmerId:"ИП Кузнецов К.К.",createdAt:"2025-05-03T13:00:00Z",email:"[email protected]",phone:"+7 (705) 678-90-12"},{id:"ad-9",culture:"Подсолнечник",sort:"Масличный",addres:"Россия, Саратов",price:"20000",value:"5",shipment:"2025-06-20",description:"Подсолнечник для масла",farmerId:"ООО МаслоТорг",createdAt:"2025-05-02T10:00:00Z",email:"[email protected]",phone:"+7 (706) 789-01-23"}],d=[],l=[],s=[{id:"contract-1",lot:"Пшеница",farmerId:"ООО Золотая Нива",buyerId:o,buyerName:c,price:1e4,volume:6,status:"pending-buyer",createdAt:"2025-05-14T10:00:00Z"},{id:"contract-2",lot:"Рожь",farmerId:"ИП Иванов А.А.",buyerId:o,buyerName:c,price:8500,volume:10,status:"pending-farmer",buyerConfirmed:!0,createdAt:"2025-05-14T11:00:00Z"},{id:"contract-3",lot:"Ячмень",farmerId:"ООО Сельхозпродукт",buyerId:o,buyerName:c,price:9e3,volume:8,status:"confirmed",buyerConfirmed:!0,farmerConfirmed:!0,createdAt:"2025-05-14T12:00:00Z"},{id:"contract-4",lot:"Кукуруза",farmerId:"ИП Петров П.П.",buyerId:o,buyerName:c,price:12e3,volume:12,status:"paid",buyerConfirmed:!0,farmerConfirmed:!0,paymentFile:"payment-order-123.pdf",createdAt:"2025-05-14T13:00:00Z"}],p=[{id:"auc-1",lot:"Пшеница",farmerId:"ООО Золотая Нива",volume:6,currentBid:1e4,minStep:500,endTime:"2025-05-14T16:00:00Z",bidders:[{buyerId:i[0].id,bid:1e4}],status:"active"},{id:"auc-2",lot:"Рожь",farmerId:"ИП Иванов А.А.",volume:10,currentBid:8500,minStep:500,endTime:"2025-05-14T17:00:00Z",bidders:[{buyerId:i[1].id,bid:8500}],status:"active"},{id:"auc-3",lot:"Ячмень",farmerId:"ООО Сельхозпродукт",volume:8,currentBid:9e3,minStep:500,endTime:"2025-05-14T18:00:00Z",bidders:[{buyerId:i[2].id,bid:9e3}],status:"active"},{id:"auc-4",lot:"Кукуруза",farmerId:"ИП Петров П.П.",volume:12,currentBid:12e3,minStep:500,endTime:new Date(Date.now()+3e4).toISOString(),bidders:[],status:"active"},{id:"auc-5",lot:"Овёс",farmerId:"ИП Сидоров С.С.",volume:7,currentBid:7e3,minStep:500,endTime:"2025-05-14T19:00:00Z",bidders:[{buyerId:i[0].id,bid:7e3}],status:"active"}],f=function(){var e=document.querySelector(".notifications__list"),t=document.querySelector(".notifications"),n=document.querySelector(".contracts"),r=document.querySelector(".deals__placeholder");e&&t&&n&&r&&(e.innerHTML="",l.filter((function(e){return e.userId===o})).forEach((function(t){var n=document.createElement("li");n.classList.add("notification__item"),n.dataset.notificationId=t.id,"counter-offer-sent"!==t.type&&"contract-pending"!==t.type&&"contract-confirmed"!==t.type&&"auction-bid"!==t.type&&"auction-won"!==t.type||(n.innerHTML="<span>".concat(t.message,"</span>")),e.appendChild(n)})),h())},m=function(){var e=document.querySelector(".contracts__list"),t=document.querySelector(".notifications"),n=document.querySelector(".contracts"),o=document.querySelector(".deals__placeholder");if(e&&t&&n&&o){var c=e.querySelector(".contracts__header");e.innerHTML="",e.appendChild(c),s.forEach((function(t){var n=document.createElement("li");n.classList.add("contract__item"),n.dataset.contractId=t.id;var r="pending-buyer"===t.status?"Ожидает вашего подтверждения":"pending-farmer"===t.status?"Ожидает подтверждения продавца":"confirmed"===t.status?"Принято":"paid"===t.status?"Оплачено":"Неизвестный статус",a="pending-buyer"===t.status?'<button class="contract__button confirm-contract" data-contract-id="'.concat(t.id,'">Подтвердить</button>'):"confirmed"===t.status?'<button class="contract__button upload-payment" data-contract-id="'.concat(t.id,'">Загрузить платёжное поручение</button>'):"paid"===t.status?'<button class="contract__button download-report" data-contract-id="'.concat(t.id,'">Скачать отчёт</button>'):"";n.innerHTML='\n        <span class="contract__field">'.concat(t.id,'</span>\n        <span class="contract__field">').concat(t.lot,'</span>\n        <span class="contract__field">').concat(t.farmerId,'</span>\n        <span class="contract__field">').concat(t.price,' ₽/т</span>\n        <span class="contract__field">').concat(t.volume,' т</span>\n        <span class="contract__field">').concat(r,'</span>\n        <span class="contract__field">').concat(a,"</span>\n      "),e.appendChild(n)})),s.forEach((function(e){"pending-farmer"!==e.status||e.farmerConfirmationTimer||(e.farmerConfirmationTimer=setTimeout((function(){e.farmerConfirmed=!0,e.status="confirmed",l.push({id:"notif-".concat(l.length+1),userId:e.buyerId,type:"contract-confirmed",contractId:e.id,message:"Контракт ".concat(e.id," полностью подтверждён."),createdAt:(new Date).toISOString()}),f(),m()}),1e4))})),h(),document.querySelectorAll(".confirm-contract").forEach((function(e){e.addEventListener("click",(function(){var t=e.dataset.contractId,n=s.find((function(e){return e.id===t}));if(n){var o=document.querySelector("#confirm-contract-popup");o?(o.querySelector(".contract-detail__value[data-field='lot']").textContent=n.lot,o.querySelector(".contract-detail__value[data-field='farmerId']").textContent=n.farmerId,o.querySelector(".contract-detail__value[data-field='price']").textContent=n.price,o.querySelector(".contract-detail__value[data-field='volume']").textContent=n.volume,r(o),o.querySelector(".confirm-contract-button").addEventListener("click",(function(){"pending-buyer"===n.status&&(n.buyerConfirmed=!0,n.status=n.farmerConfirmed?"confirmed":"pending-farmer"),"confirmed"===n.status&&l.push({id:"notif-".concat(l.length+1),userId:n.buyerId,type:"contract-confirmed",contractId:n.id,message:"Контракт ".concat(n.id," полностью подтверждён."),createdAt:(new Date).toISOString()}),f(),m(),a(o)}))):console.warn("Confirm contract popup not found")}}))})),document.querySelectorAll(".upload-payment").forEach((function(e){e.addEventListener("click",(function(){var t=e.dataset.contractId,n=s.find((function(e){return e.id===t}));if(n){var o=document.querySelector("#upload-payment-popup");if(o){r(o);var c=o.querySelector(".upload-payment-form"),i=o.querySelector("#payment-file");c.addEventListener("submit",(function(e){if(e.preventDefault(),i.files.length>0)n.status="paid",n.paymentFile=i.files[0].name,l.push({id:"notif-".concat(l.length+1),userId:n.buyerId,type:"contract-paid",contractId:n.id,message:"Платёжное поручение для контракта ".concat(n.id," загружено. Статус: Оплачено."),createdAt:(new Date).toISOString()}),f(),m(),a(o);else{var t=document.createElement("div");t.textContent="Пожалуйста, выберите файл для загрузки!",t.className="notification__message error",document.body.appendChild(t),setTimeout((function(){return t.remove()}),3e3)}}))}else console.warn("Upload payment popup not found")}}))})),document.querySelectorAll(".download-report").forEach((function(e){e.addEventListener("click",(function(){var t=e.dataset.contractId,n=s.find((function(e){return e.id===t}));if(n){var r=v(n),a=new Blob([r],{type:"application/x-tex"}),o=URL.createObjectURL(a),c=document.createElement("a");c.href=o,c.download="contract-report-".concat(n.id,".tex"),c.click(),URL.revokeObjectURL(o)}}))}))}},v=function(e){return"\n\\documentclass[a4paper,12pt]{article}\n\\usepackage[utf8]{inputenc}\n\\usepackage[russian]{babel}\n\\usepackage{geometry}\n\\geometry{margin=1in}\n\\usepackage{fancyhdr}\n\\pagestyle{fancy}\n\\fancyhf{}\n\\fancyhead[C]{Итоговый отчёт по контракту №".concat(e.id,"}\n\\fancyfoot[C]{\\thepage}\n\n\\begin{document}\n\n\\begin{center}\n  \\Large \\textbf{Итоговый отчёт по контракту №").concat(e.id,"} \\\\\n  \\normalsize Для покупателя, продавца и реестра контроля\n\\end{center}\n\n\\vspace{1cm}\n\n\\section*{Детали контракта}\n\\begin{itemize}\n  \\item \\textbf{ID контракта:} ").concat(e.id,"\n  \\item \\textbf{Лот:} ").concat(e.lot,"\n  \\item \\textbf{Продавец:} ").concat(e.farmerId,"\n  \\item \\textbf{Покупатель:} ").concat(e.buyerName||"ООО АгроТрейд","\n  \\item \\textbf{Цена:} ").concat(e.price," ₽/т\n  \\item \\textbf{Объём:} ").concat(e.volume," т\n  \\item \\textbf{Дата создания:} ").concat(new Date(e.createdAt).toLocaleDateString("ru-RU"),"\n  \\item \\textbf{Статус:} Оплачено\n  \\item \\textbf{Файл платёжного поручения:} ").concat(e.paymentFile||"Не указано","\n\\end{itemize}\n\n\\vspace{1cm}\n\n\\section*{Подписи}\n\\begin{itemize}\n  \\item Продавец: ___________________________ (Подпись)\n  \\item Покупатель: ___________________________ (Подпись)\n  \\item Реестр контроля: ___________________________ (Подпись)\n\\end{itemize}\n\n\\end{document}\n    ")},h=function(){var e=document.querySelector(".notifications"),t=document.querySelector(".contracts"),n=document.querySelector(".deals__placeholder");l.filter((function(e){return e.userId===o})).length>0||s.length>0?(n.classList.add("deals__placeholder--hidden"),e.classList.remove("notifications--hidden"),t.classList.remove("contracts--hidden")):(n.classList.remove("deals__placeholder--hidden"),e.classList.add("notifications--hidden"),t.classList.add("contracts--hidden"))},y=function(){var e=document.querySelector(".auc__list"),t=document.querySelector(".auc__placeholder");if(e&&t){var n=e.querySelector(".auc__list-header");e.innerHTML="",e.appendChild(n);var u=p.filter((function(e){return"active"===e.status}));0!==u.length?(t.classList.add("auc__placeholder--hidden"),u.forEach((function(t){var n,r=document.createElement("li");r.classList.add("auc__item"),r.dataset.auctionId=t.id;var a=t.bidders.length>0?t.bidders[t.bidders.length-1].buyerId:"Нет ставок",o="Нет ставок"!==a?(null===(n=i.find((function(e){return e.id===a})))||void 0===n?void 0:n.name)||c:"Нет ставок",u=_(t.endTime);r.innerHTML='\n        <span class="auc__field">'.concat(t.lot,'</span>\n        <span class="auc__field">').concat(t.farmerId,'</span>\n        <span class="auc__field">').concat(t.currentBid,' ₽/т</span>\n        <span class="auc__field">').concat(o,'</span>\n        <span class="auc__field auc__timer" data-end-time="').concat(t.endTime,'">').concat(u,'</span>\n        <span class="auc__field">\n          <button class="auc__button bid-button" data-auction-id="').concat(t.id,'" ').concat("Аукцион завершён"===u?"disabled":"",">Сделать ставку</button>\n        </span>\n      "),e.appendChild(r)})),document.querySelectorAll(".bid-button").forEach((function(e){e.addEventListener("click",(function(){var t=e.dataset.auctionId,n=p.find((function(e){return e.id===t}));if(n){var i=document.querySelector("#bid-popup");if(i){i.querySelector(".bid-detail__value[data-field='lot']").textContent=n.lot,i.querySelector(".bid-detail__value[data-field='farmerId']").textContent=n.farmerId,i.querySelector(".bid-detail__value[data-field='currentBid']").textContent=n.currentBid,i.querySelector(".bid-detail__value[data-field='minBid']").textContent=n.currentBid+n.minStep;var u=i.querySelector("#bid-amount");u.setAttribute("min",n.currentBid+n.minStep),u.value=n.currentBid+n.minStep,r(i),i.querySelector(".bid-form").addEventListener("submit",(function(e){e.preventDefault();var t=parseFloat(u.value);if(t<n.currentBid+n.minStep){var r=document.createElement("div");return r.textContent="Ставка должна быть не менее ".concat(n.currentBid+n.minStep," ₽/т!"),r.className="notification__message error",document.body.appendChild(r),void setTimeout((function(){return r.remove()}),3e3)}var d,p=function(e){if(Array.isArray(e))return g(e)}(d=n.bidders)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(d)||function(e,t){if(e){if("string"==typeof e)return g(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}(d)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();n.currentBid=t,n.bidders.push({buyerId:o,bid:t}),p.forEach((function(e){e.buyerId!==o&&l.push({id:"notif-".concat(l.length+1),userId:e.buyerId,type:"auction-bid",auctionId:n.id,message:"Вашу ставку на лот ".concat(n.lot," перебил ").concat(c," с ").concat(t," ₽/т."),createdAt:(new Date).toISOString()})})),l.push({id:"notif-".concat(l.length+1),userId:o,type:"auction-bid",auctionId:n.id,message:"Вы сделали ставку ".concat(t," ₽/т на лот ").concat(n.lot,"."),createdAt:(new Date).toISOString()}),s.push({id:"contract-".concat(s.length+1),lot:n.lot,farmerId:n.farmerId,buyerId:o,buyerName:c,price:n.currentBid,volume:n.volume,status:"pending-buyer",createdAt:(new Date).toISOString()}),f(),y(),a(i)}))}else console.warn("Bid popup not found")}}))}))):t.classList.remove("auc__placeholder--hidden")}},_=function(e){var t=new Date,n=new Date(e)-t;if(n<=0)return"Аукцион завершён";var r=Math.floor(n/36e5),a=Math.floor(n%36e5/6e4),o=Math.floor(n%6e4/1e3);return"".concat(r,"ч ").concat(a,"м ").concat(o,"с")};b(u),(t=document.querySelector(".catalog__filters"))?(t.addEventListener("submit",(function(e){e.preventDefault();var t=document.querySelector("#filter-culture").value,n=document.querySelector("#filter-sort").value,r=document.querySelector("#filter-region").value,a=parseFloat(document.querySelector("#filter-price-min").value)||0,o=parseFloat(document.querySelector("#filter-price-max").value)||1/0,c=parseFloat(document.querySelector("#filter-volume-min").value)||0,i=parseFloat(document.querySelector("#filter-volume-max").value)||1/0,d=document.querySelector("#sort-by").value,l=u.filter((function(e){return(!t||e.culture===t)&&(!n||e.sort===n)&&(!r||e.addres.includes(r))&&parseFloat(e.price)>=a&&parseFloat(e.price)<=o&&parseFloat(e.value)>=c&&parseFloat(e.value)<=i}));b(l=l.sort((function(e,t){return"price-asc"===d?parseFloat(e.price)-parseFloat(t.price):"price-desc"===d?parseFloat(t.price)-parseFloat(e.price):"date-desc"===d?new Date(t.createdAt)-new Date(e.createdAt):"date-asc"===d?new Date(e.createdAt)-new Date(t.createdAt):0})))})),document.querySelector(".catalog__filters-reset").addEventListener("click",(function(){t.reset(),b(u)}))):console.warn("Filter form not found"),Object.values({catalog:{link:".header__link-catalog",section:".catalog"},auc:{link:".header__link-auc",section:".auc"},deals:{link:".header__link-deals",section:".deals"},profile:{link:".header__link-profile",section:".profile"}}).forEach((function(e){var t=e.link,n=e.section,r=document.querySelector(t);r?r.addEventListener("click",(function(e){e.preventDefault();var t=document.querySelector(".active-sec"),r=document.querySelector(".active");t&&t.classList.remove("active-sec"),r&&r.classList.remove("active");var a=document.querySelector(n);a?(a.classList.add("active-sec"),e.target.classList.add("active")):console.warn("Section ".concat(n," not found"))})):console.warn("Navigation link ".concat(t," not found"))})),(n=document.querySelector(".contact-button"))&&n.addEventListener("click",(function(){var e=document.querySelector("#ad-detail-popup"),t=document.querySelector("#contact-popup");if(e&&t){var n=e.querySelector(".ad-detail__value[data-field='email']").textContent,o=e.querySelector(".ad-detail__value[data-field='phone']").textContent;t.querySelector(".contact-value[data-field='email']").textContent=n,t.querySelector(".contact-value[data-field='phone']").textContent=o,a(e),r(t),t.querySelector(".copy-button").addEventListener("click",(function(){navigator.clipboard.writeText(n).then((function(){var e=document.createElement("div");e.textContent="E-mail скопирован в буфер обмена!",e.className="notification__message",document.body.appendChild(e),setTimeout((function(){return e.remove()}),3e3)}))})),t.querySelector(".call-button").addEventListener("click",(function(){window.location.href="tel:".concat(o)}))}else console.warn("Contact popup not found")})),function(){var e=document.querySelector(".request-button");if(e){var t=document.querySelector("#request-popup");if(t){var n=null;e.addEventListener("click",(function(){var e,o=document.querySelector("#ad-detail-popup");if(o){var c=(null===(e=o.querySelector(".ad-detail__value[data-field='id']"))||void 0===e?void 0:e.textContent)||"";(n=u.find((function(e){return e.id===c})))||(n=u.find((function(e){return e.culture===o.querySelector(".ad-detail__value[data-field='culture']").textContent})));var i=t.querySelector("#request-volume");i.setAttribute("max",n.value),i.value="",t.querySelector("#request-price").value="",t.querySelector("#request-comment").value="",a(o),r(t)}else console.warn("Ad detail popup not found")}));var i=t.querySelector(".request-form");i&&i.addEventListener("submit",(function(e){e.preventDefault();var r=parseFloat(i.querySelector("#request-volume").value),u=parseFloat(i.querySelector("#request-price").value),p=i.querySelector("#request-comment").value;if(r>parseFloat(n.value)){var v=document.createElement("div");return v.textContent="Объём не может превышать предложенный в объявлении!",v.className="notification__message error",document.body.appendChild(v),void setTimeout((function(){return v.remove()}),3e3)}var h={id:"counter-".concat(d.length+1),adId:n.id,buyerId:o,buyerName:c,farmerId:n.farmerId,culture:n.culture,volume:r,price:u,comment:p,status:"pending",createdAt:(new Date).toISOString()};d.push(h),s.push({id:"contract-".concat(s.length+1),lot:n.culture,farmerId:n.farmerId,buyerId:o,buyerName:c,price:u,volume:r,status:"pending-buyer",createdAt:(new Date).toISOString()}),l.push({id:"notif-".concat(l.length+1),userId:n.farmerId,type:"counter-offer",counterOfferId:h.id,message:"Покупатель ".concat(c," отправил встречную заявку на ").concat(n.culture,": ").concat(r," тонн по ").concat(u," ₽/т."),createdAt:(new Date).toISOString()}),l.push({id:"notif-".concat(l.length+1),userId:o,type:"counter-offer-sent",counterOfferId:h.id,message:"Ваша встречная заявка на ".concat(n.culture," (").concat(r," тонн по ").concat(u," ₽/т) отправлена продавцу ").concat(n.farmerId,"."),createdAt:(new Date).toISOString()}),f(),m(),a(t)}))}else console.warn("Request popup not found")}}(),f(),m(),y(),setInterval((function(){document.querySelectorAll(".auc__timer").forEach((function(e){var t=e.dataset.endTime,n=_(t);if(e.textContent=n,"Аукцион завершён"===n){var r=e.closest(".auc__item").dataset.auctionId,a=p.find((function(e){return e.id===r}));if(a&&"active"===a.status){if(a.status="ended",a.bidders.length>0){var u,d=a.bidders[a.bidders.length-1],v=d.buyerId===o?c:(null===(u=i.find((function(e){return e.id===d.buyerId})))||void 0===u?void 0:u.name)||d.buyerId;s.push({id:"contract-".concat(s.length+1),lot:a.lot,farmerId:a.farmerId,buyerId:d.buyerId,buyerName:v,price:a.currentBid,volume:a.volume,status:"pending-buyer",createdAt:(new Date).toISOString()}),l.push({id:"notif-".concat(l.length+1),userId:d.buyerId,type:"auction-won",auctionId:a.id,message:"Поздравляем! Вы выиграли аукцион на лот ".concat(a.lot," за ").concat(a.currentBid," ₽/т. Подтвердите контракт."),createdAt:(new Date).toISOString()})}f(),m(),y()}}}))}),1e3),setInterval((function(){var e=p.filter((function(e){return"active"===e.status}));0!==e.length&&e.forEach((function(e){if(Math.random()<.3){var t=i[Math.floor(Math.random()*i.length)],n=e.currentBid+e.minStep*(Math.floor(3*Math.random())+1);e.bidders.push({buyerId:t.id,bid:n}),e.currentBid=n,l.push({id:"notif-".concat(l.length+1),userId:o,type:"auction-bid",auctionId:e.id,message:"Ставку на лот ".concat(e.lot," повысил ").concat(t.name," до ").concat(n," ₽/т!"),createdAt:(new Date).toISOString()}),f(),y()}}))}),3e4)}else console.warn("Catalog list not found in buyer.html");function b(t){var n=e.querySelector(".catalog__list-header");e.innerHTML="",e.appendChild(n),t.forEach((function(t){var n=document.createElement("li");n.classList.add("catalog__item"),n.dataset.id=t.id,n.innerHTML='\n        <span class="catalog__ad">'.concat(t.culture,'</span>\n        <span class="catalog__ad">').concat(t.sort,'</span>\n        <span class="catalog__ad">').concat(t.addres,'</span>\n        <span class="catalog__ad">').concat(t.price,'</span>\n        <span class="catalog__ad">').concat(t.value,'</span>\n        <span class="catalog__ad">').concat(t.shipment,'</span>\n        <span class="catalog__ad">').concat(t.description,"</span>\n      "),e.appendChild(n)})),document.querySelectorAll(".catalog__item").forEach((function(e){e.addEventListener("click",(function(){var t=e.dataset.id,n=u.find((function(e){return e.id===t}));if(n){var a=document.querySelector("#ad-detail-popup");if(!a)return void console.warn("Ad detail popup not found");a.querySelectorAll(".ad-detail__value").forEach((function(e){var t=e.dataset.field;e.textContent=n[t]||"Не указано"})),r(a)}}))}))}}()})();